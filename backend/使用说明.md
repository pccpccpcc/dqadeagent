# Backend服务使用说明

## 🎉 服务已成功启动！

### 📊 服务信息
- **服务状态**: ✅ 运行中
- **进程ID**: 16632
- **服务地址**: http://localhost:8000
- **API文档**: http://localhost:8000/docs
- **日志文件**: uvicorn.log

### 🔧 服务管理

使用 `manage.sh` 脚本管理服务：

```bash
cd /Users/pengchengchen/Desktop/dqadeagent/backend

# 查看服务状态
./manage.sh status

# 停止服务
./manage.sh stop

# 启动服务
./manage.sh start

# 重启服务
./manage.sh restart

# 查看实时日志
./manage.sh logs

# 测试服务接口
./manage.sh test
```

### 📡 API接口示例

#### 1. 获取模板查询统计
```bash
curl "http://localhost:8000/api/template-query/stats?queryDate=2024-11-20"
```

#### 2. 获取渠道统计
```bash
curl "http://localhost:8000/api/channel-stats?queryDate=2024-11-20"
```

#### 3. 获取查询趋势
```bash
curl "http://localhost:8000/api/weekly-query-trend?start_date=2024-11-01&end_date=2024-11-20"
```

#### 4. 查看所有可用接口
访问 http://localhost:8000/docs 查看完整的API文档和在线测试

### 🗄️ 数据库配置

当前数据库配置（在 `db_session.py` 中）：
- **主机**: localhost:3306
- **数据库**: dqadeagent
- **用户**: root
- **连接状态**: ✅ 正常

如需修改数据库配置，请编辑 `db_session.py` 文件中的 `DatabaseConfig` 类。

### 📝 日志查看

```bash
# 查看实时日志
tail -f uvicorn.log

# 查看最后50行日志
tail -50 uvicorn.log

# 搜索错误日志
grep ERROR uvicorn.log
```

### 🔍 故障排查

#### 服务无法启动
1. 检查端口是否被占用：
   ```bash
   lsof -i :8000
   ```

2. 检查数据库连接：
   ```bash
   python3 -c "from db_session import get_db_session; s=get_db_session(); print('连接成功'); s.close()"
   ```

3. 查看错误日志：
   ```bash
   cat uvicorn.log
   ```

#### 端口被占用
```bash
# 查找占用端口的进程
lsof -ti :8000

# 停止占用端口的进程
lsof -ti :8000 | xargs kill -9
```

### 🚀 性能优化建议

1. **生产环境部署**
   - 使用 Nginx 作为反向代理
   - 配置 HTTPS
   - 使用进程管理工具（如 supervisor 或 systemd）

2. **数据库优化**
   - 添加适当的索引
   - 配置连接池大小
   - 定期清理旧数据

3. **监控和日志**
   - 配置日志轮转
   - 添加性能监控
   - 设置告警机制

### 📚 更多信息

详细的技术文档请查看：
- `README.md` - 项目说明和架构文档
- `SERVICE_STATUS.md` - 服务状态详细报告
- `database.py` - 数据库操作文档

### ⚠️ 注意事项

1. 服务运行在开发模式，生产环境需要额外配置
2. 数据库密码明文存储在代码中，生产环境建议使用环境变量
3. 当前未配置访问控制，建议添加认证机制
4. 建议定期备份数据库

### 🆘 获取帮助

如遇问题，请：
1. 查看日志文件 `uvicorn.log`
2. 运行 `./manage.sh test` 测试服务
3. 检查数据库连接状态
4. 查看 `SERVICE_STATUS.md` 了解已知问题和解决方案

---

**最后更新**: 2024-11-23  
**服务版本**: 1.0.0  
**Python版本**: 3.13.2  
**FastAPI版本**: 0.115.12

